<!doctype html><meta charset="utf-8">
<title>Watch Checkpoints v0.1</title>
<style>
:root{--bg:#0b0c06;--grid:#1a2b1a;--text:#b4ffb4;--glow:#39ff14;--danger:#ff6b6b}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:ui-monospace,Consolas,monospace}
.wrap{max-width:860px;margin:0 auto;padding:12px}
.h{display:flex;justify-content:space-between;align-items:center}
.btn{border:1px solid var(--grid);background:#0f140f;color:var(--text);padding:8px 10px;border-radius:8px}
.tile{border:1px solid var(--grid);border-radius:12px;background:#0f130f;padding:10px;margin:8px 0}
.err{border-color:var(--danger);color:var(--danger);padding:10px;border-radius:8px;background:#170b0b}
.kv{display:grid;grid-template-columns:max-content 1fr;gap:6px 12px}
.kv b{color:var(--glow)}
small{opacity:.8}
</style>
<div class="wrap">
  <div class="h">
    <h1 style="margin:0;color:var(--glow)">Watch Checkpoints</h1>
    <button id="reload" class="btn">Reload</button>
  </div>
  <div class="tile"><b>Source</b>: <code id="src"></code></div>
  <div id="out" class="tile"><small>Waiting…</small></div>
  <div id="raw" class="tile" hidden></div>
  <div id="err" class="err" hidden></div>
</div>
<script>
const qs=new URLSearchParams(location.search);
const src=qs.get('src') || '/receipts/sr_watch_checkpoint_v0_1.json';
document.getElementById('src').textContent=src;
async function load(){
  const out=document.getElementById('out');
  const raw=document.getElementById('raw');
  const err=document.getElementById('err');
  err.hidden=true; out.innerHTML='<small>Loading…</small>'; raw.hidden=true;
  try{
    const r=await fetch(src,{cache:'no-store'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const j=await r.json();
    // Render summary
    const gen=j.generated_at || j.generatedAt || '(unknown)';
    const cfg=j.cfg_sha256 || j.cfg_sha || '(n/a)';
    const caps=Array.isArray(j.captures)? j.captures.length : 0;
    const offenders=Array.isArray(j.offenders)? j.offenders.length : 0;
    const diffs=Array.isArray(j.diff_files)? j.diff_files.length : 0;
    out.innerHTML = `
      <div class="kv">
        <b>generated_at</b><span>${gen}</span>
        <b>cfg_sha256</b><span>${cfg}</span>
        <b>captures</b><span>${caps}</span>
        <b>offenders</b><span>${offenders}</span>
        <b>diff_files</b><span>${diffs}</span>
      </div>`;
    raw.hidden=false; raw.innerHTML = '<pre>'+JSON.stringify(j,null,2)+'</pre>';
  }catch(e){
    err.hidden=false; err.textContent='Load failed: '+e.message;
    out.innerHTML='<small>No data</small>'; raw.hidden=true;
  }
}
document.getElementById('reload').onclick=load;
load();
</script>
