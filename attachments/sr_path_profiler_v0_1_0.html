<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Path Profiler — v0.1.0</title>
<style>
:root{ --bg:#0b0c06; --grid:#1a2b1a; --text:#b4ffb4; --ok:#39ff14; --bad:#ff6b6b }
html,body{margin:0;background:#0b0c06;color:#b4ffb4;font-family:ui-monospace,Consolas,monospace}
.wrap{max-width:980px;margin:0 auto;padding:12px}
.card{border:1px solid var(--grid);border-radius:12px;background:#0f140f;padding:12px;margin-top:10px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:6px 0}
input,button,textarea{border:1px solid var(--grid);background:#0a0f0a;color:#b4ffb4;border-radius:8px;padding:8px}
button{cursor:pointer}
pre{white-space:pre-wrap;word-break:break-word;font-size:12px;line-height:1.35}
.small{font-size:12px;color:#9ae89a}
canvas{width:100%;height:180px;background:#0a0f0a;border:1px solid var(--grid);border-radius:8px}
</style>
<script src="https://cdn.jsdelivr.net/npm/geotiff@2.0.7/dist-browser/geotiff.min.js"></script>
</head>
<body>
<div class="wrap">
  <div class="small">Static Rooster • Path Profiler v0.1.0</div>
  <div class="card">
    <div class="row">
      <input type="file" id="file" accept=".tif,.tiff">
      <button id="btnOpen">Open Raster</button>
      <textarea id="pts" rows="3" placeholder="Path points x,y per line (pixel coords)"></textarea>
      <button id="btnProfile">Profile</button>
    </div>
  </div>
  <div class="card">
    <div class="small">Chart (value vs. step)</div>
    <canvas id="chart" width="800" height="180"></canvas>
  </div>
  <div class="card">
    <div class="small">Stats</div>
    <pre id="out">—</pre>
  </div>
</div>
<script>
let image=null;
document.getElementById('btnOpen').onclick = async ()=>{
  const f = document.getElementById('file').files[0]; if(!f) return alert('Choose a file');
  const buf = await f.arrayBuffer(); const tiff = await GeoTIFF.fromArrayBuffer(buf); image = await tiff.getImage(); alert('Raster loaded: '+image.getWidth()+'×'+image.getHeight());
};
function parsePts(txt){
  return txt.split(/\n+/).map(l=>l.trim()).filter(Boolean).map(l=>l.split(',').map(x=>parseInt(x,10))).filter(p=>p.length===2);
}
async function profile(){
  if(!image) return alert('Load raster first.');
  const pts = parsePts(document.getElementById('pts').value); if(pts.length<2) return alert('Enter >=2 points');
  const values=[];
  for(const [x,y] of pts){
    const data = await image.readRasters({window:[x,y,x+1,y+1],samples:[0]});
    values.push((data[0]||[NaN])[0]);
  }
  draw(values);
  const min=Math.min(...values), max=Math.max(...values), avg=values.reduce((a,b)=>a+b,0)/values.length;
  document.getElementById('out').textContent = JSON.stringify({points:pts.length,min,max,avg:Math.round(avg*100)/100}, null, 2);
}
function draw(vals){
  const c=document.getElementById('chart'), g=c.getContext('2d'); g.clearRect(0,0,c.width,c.height);
  const w=c.width, h=c.height; const n=vals.length; if(!n) return;
  const min=Math.min(...vals), max=Math.max(...vals), rng=(max-min)||1;
  g.beginPath(); for(let i=0;i<n;i++){ const x=i*(w/(n-1||1)); const y=h-((vals[i]-min)/rng)*h; if(i===0) g.moveTo(x,y); else g.lineTo(x,y); } g.strokeStyle='#39ff14'; g.lineWidth=2; g.stroke();
}
document.getElementById('btnProfile').onclick = profile;
</script>
</body>
</html>
