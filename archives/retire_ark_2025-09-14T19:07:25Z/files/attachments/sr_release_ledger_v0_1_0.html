<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Release Ledger — v0.1.0</title>
<style>
:root{ --bg:#0b0c06; --grid:#1a2b1a; --text:#b4ffb4; --ok:#39ff14; --bad:#ff6b6b }
html,body{margin:0;background:#0b0c06;color:#b4ffb4;font-family:ui-monospace,Consolas,monospace}
.wrap{max-width:1000px;margin:0 auto;padding:12px}
.card{border:1px solid var(--grid);border-radius:12px;background:#0f140f;padding:12px;margin-top:10px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:6px 0}
input,button,textarea{border:1px solid var(--grid);background:#0a0f0a;color:#b4ffb4;border-radius:8px;padding:8px}
button{cursor:pointer}
.small{font-size:12px;color:#9ae89a}
pre{white-space:pre-wrap;word-break:break-word;font-size:12px;line-height:1.35}
table{width:100%;border-collapse:collapse;font-size:12px;margin-top:8px} th,td{border-bottom:1px solid var(--grid);padding:6px;vertical-align:top}
</style>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
<div class="wrap">
  <div class="small">Static Rooster • Release Ledger v0.1.0</div>
  <div class="card">
    <div class="row">
      <input type="file" id="in" multiple>
      <button id="btnParse">Ingest Drops/ZIPs</button>
      <button id="btnExport">Export Ledger (JSON)</button>
    </div>
    <div class="row">
      <textarea id="note" rows="2" placeholder="Add a brief operator note (will attach to the next entry)"></textarea>
    </div>
  </div>
  <div class="card">
    <table id="tbl"><thead><tr><th>When</th><th>Seal</th><th>Cluster</th><th>Step</th><th>Kind</th><th>Note</th></tr></thead><tbody></tbody></table>
  </div>
  <div class="card">
    <div class="small">Ledger JSON</div>
    <pre id="out">[]</pre>
  </div>
</div>
<script>
let ledger=[];
function addEntry(obj, note){ ledger.push({ when: obj.when||obj.generatedAt||new Date().toISOString(), seal: (obj.content?.foedus_intactum===true?'foedus intactum':'') || (obj.content?.seal||''), cluster: obj.cluster||'', step: obj.step||'', kind: obj.kind||obj.content?.rite||'', note: note||'' }); render(); }
function render(){
  ledger.sort((a,b)=> (a.when<b.when?-1:1));
  const tb=document.querySelector('#tbl tbody'); tb.innerHTML='';
  ledger.forEach(e=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${e.when}</td><td>${e.seal}</td><td>${e.cluster}</td><td>${e.step}</td><td>${e.kind}</td><td>${(e.note||'')}</td>`; tb.appendChild(tr); });
  document.getElementById('out').textContent = JSON.stringify(ledger, null, 2);
}
async function parseFile(f, note){
  // Handle drop json
  if(/\.json$/i.test(f.name)){
    try{ const obj = JSON.parse(await f.text()); if(obj.schema && (obj.schema.includes('drop') || obj.schema.includes('watch.checkpoint'))){ addEntry(obj, note); } }catch(_){}
  }
  // Handle bundle zip
  if(/\.zip$/i.test(f.name)){
    const zip = await JSZip.loadAsync(f);
    for(const path in zip.files){ if(/drop_.*\.json$/i.test(path)){ try{ const obj=JSON.parse(await zip.file(path).async('string')); addEntry(obj, note); }catch(_){ } } }
  }
}
document.getElementById('btnParse').onclick = async ()=>{
  const list = document.getElementById('in').files; if(!list?.length) return alert('Choose drops or zips');
  const note = document.getElementById('note').value.trim(); for(const f of list){ await parseFile(f, note); }
};
document.getElementById('btnExport').onclick = ()=>{
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(ledger,null,2)],{type:'application/json'})); a.download='sr_release_ledger.json'; a.click();
};
render();
</script>
</body></html>
